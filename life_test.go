package life

import (
	"fmt"
	"testing"
)

func TestRowSum(t *testing.T) {
	rows := 40
	cols := 50
	b := MakeBoard(rows, cols)
	s := make([]byte, cols)

	b.Set(0, 0, true)
	b.Set(0, 1, true)
	b.rowSum(0, s)
	if s[0] != 2 {
		t.Fail()
	}

	b.Set(5, 7, true)
	b.Set(5, 8, true)
	b.Set(5, 9, true)
	b.rowSum(5, s)
	if s[6] != 1 {
		t.Fail()
	}
	if s[7] != 2 {
		t.Fail()
	}
	if s[8] != 3 {
		t.Fail()
	}
	if s[9] != 2 {
		t.Fail()
	}
	if s[10] != 1 {
		t.Fail()
	}
	if s[11] != 0 {
		t.Fail()
	}
}

func ExampleGosperGliderGun() {
	const (
		X = true
		O = false
	)
	b := MakeBoard(40, 50)

	BoardSet(b, 0, 0, [][]bool{
		{O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, X, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, X, O, X, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, O, O, O, O, O, O, O, O, O, O, O, O, X, X, O, O, O, O, O, O, X, X, O, O, O, O, O, O, O, O, O, O, O, O, X, X, O},
		{O, O, O, O, O, O, O, O, O, O, O, O, X, O, O, O, X, O, O, O, O, X, X, O, O, O, O, O, O, O, O, O, O, O, O, X, X, O},
		{O, X, X, O, O, O, O, O, O, O, O, X, O, O, O, O, O, X, O, O, O, X, X, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, X, X, O, O, O, O, O, O, O, O, X, O, O, O, X, O, X, X, O, O, O, O, X, O, X, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, O, O, O, O, O, O, O, O, O, O, X, O, O, O, O, O, X, O, O, O, O, O, O, O, X, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, O, O, O, O, O, O, O, O, O, O, O, X, O, O, O, X, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, O, O, O, O, O, O, O, O, O, O, O, O, X, X, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O},
		{O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O, O},
	})

	b.Advance(500)
	fmt.Print(Fmt(b))

	// Output:
	//..................................................
	//...........................XX.....................
	//..........................X...X...................
	//..........XX.............X.....X...XX.............
	//..........XX.............X...X.XX..XX.............
	//.XX...X......XX..........X.....X..................
	//.X.X...X.....XXX..........X...X...................
	//..XXXXX......XX............XX.....................
	//...XXX....XX.........X.X..........................
	//..........XX..........XX..........................
	//......................X...........................
	//..................................................
	//..................................................
	//..................................................
	//..................................................
	//.............................X....................
	//..............................XX..................
	//.............................XX...................
	//..................................................
	//..................................................
	//..................................................
	//..................................................
	//..................................................
	//....................................X.X...........
	//.....................................XX...........
	//.....................................X............
	//..................................................
	//..................................................
	//..................................................
	//..................................................
	//............................................X.....
	//.............................................XX...
	//............................................XX....
	//..................................................
	//..................................................
	//................................................XX
	//................................................XX
	//..................................................
	//..................................................
	//..................................................
}

func ExampleAdvance() {
	b := MakeBoard(16, 16)
	SetRand(b, 0, 0.5)

	b.Advance(1)
	fmt.Print(Fmt(b))

	// Output:
	//..XX..XXXXXXXX.X
	//XX.....X...X.X.X
	//X.X....X.X.XXX..
	//...........XXXX.
	//..X.X.X.X....X..
	//......X.X....X..
	//X...X.....X.....
	//......X...XX.XXX
	//.......XX..X.X.X
	//X.X......X......
	//X.X......X....X.
	//X..XXX........X.
	//XX..XX..XX.....X
	//X..XX...X.XXX.X.
	//.X.X.X....XX..X.
	//..XXXXXXX.XX....
}

func ExampleAdvance_2() {
	b := MakeBoard(6, 150)
	SetRand(b, 0, 0.5)

	b.Advance(5)
	fmt.Print(Fmt(b))

	// Output:
	//.XXX.XXX.............................X.....X.XX.......XXX..........X...XX...........XXX....XXXX.....XX.........X.X......X.XX.................XXXX.XX..
	//XX.X.X.X.......X.....XX..............X.....XX.XX..X.......X.............X...X.......X.X..X.X..........X........X.X.....X....XX....................X..X
	//.....X.XXX.X...X.....XX......XX......X.......X.XX...XXX........X............X.X....X..X.....XXX.....XXX.......XX.......X......X..........X...XX.XX..XX
	//XXXX...X..XX...X....X.......XX.................X...X...X.......XX...X..X....XXX........XX.XXX.................X.X.XXX.X......XXX...X..XXX.X..X..X....X
	//.XX.XXX..X...X......X.X.....X..........X....X......X....XX....X..X....X.................X......X.XX...........X.X.XXX..X...X....X.X....XX.....XX.X.X.X
	//.......XX...........X.X...............XX....X...XXX....XX......XX.......................X.X......XX............X...X....XXXXXXXXX.X.X.X........XXXXXX.
}

func ExampleAdvance_3() {
	b := MakeBoard(3, 64)
	SetRand(b, 0, 0.5)

	b.Advance(9)
	fmt.Print(Fmt(b))

	// Output:
	//..........XX...............................X....................
	//..........X.X...............................XX.......XX.........
	//...........X...............................X.........XX.........
}

func ExampleAdvance_4() {
	b := MakeBoard(3, 65)
	SetRand(b, 0, 0.5)

	b.Advance(10)
	fmt.Print(Fmt(b))

	// Output:
	//..................XX...XX.........................XX.............
	//.................X..X..XX.......................XX.X.............
	//..................XX............................X.X..............
}

func ExampleAdvance_5() {
	b := MakeBoard(25, 255)
	SetRand(b, 0, 0.5)

	b.Advance(10)
	fmt.Print(Fmt(b))

	// Output:
	//....................................................................XXXXX............................XXX.................XXX.............XX.........XX.................XX......................XX....................................XXXX.....XXXXX....X....XX.
	//............................X........................XX.............X..XX............XX.................X..X.XX...........XX............X..X.........XX..............XX...X...................X..XX.................................X.XXX.....X...X....X......X
	//..........XX.....XXX...XX............................XXX.............XX..XX.X........XX............X....X.XX.XX..........XX............XX.XX......X...XX.............XX...X.............X....X...XX....X.....XX.XX...................X.XX....................XX
	//.........XX.X...X.XX.....X.XX.......................X..X...............XXX.XX...................X.X.......XX.XX................X........X..X.....X...X...X.............X...............XXX....X....X..X..X...XX.XX..................XX.....XX.............X.X..
	//..........X.X..........X.X.XX.....X.X................XX.....................X.....XX..............XXX.X...XXX....XXX...........X.XX........X......X..X....X..............X.X...X......X........XX.X...XXX......X....................X......XXXX..........X.X...
	//..........XX.............X..........XX............X.......X...........X.XX........XXX..........XX.X...XX..X.X......X.......X.....XX.....X..X.......X.X....XX............X.....X.X....XXX........XXX................................X......XX.XX.XX.XX..........
	//.........XX.....XXX......XX..X...XX..............XXX.....X.X.........XX.X.........XX.XX.........XXX..XXX...X......X.......X.X............XX.............XXXX..........X..X.X..X.......X....X.X..XX............XX.......................X..X.X...X...XX....X....
	//.....XX.X.X..............X..XX..................X..XX...XX.X........X.X............X.X..XX...........XX.......................................XXX.......XX...XX......XXX.XX....X..XXX..XXXX..XX.XX...........XX.X....................X.X.XXX.....XX.XX.........
	//.....XX..................X.XX.X.....................X....X.XXX.....XX.XX............XX....X.........XX.........X...........X.X.....X..X.......XXXXXX.....XXX....X.....X.X.........X......X.......X..........X...X........................XX......X.............
	//.......XXX.................X..X.....................XX....XXXX......X.XX....XX.......X.X..X....................X............X......X..X.....XXX..........XXXX....X.....X..........X.X...X.....X.X............XXX....XX............................XXX..........
	//.................XXX......X.......X................X.X....X...X.....X..X.XX.XX.......XX..X..........................XX......X.......X..X....XXX......X....XXXXX........X.X..............X......X.........X.X..X.....XX..........X....................X.........
	//....................X.....X...X.X.X................XX....X....X....XXXXXX.X.X.........XXX.......X..................X..X...............XX.....XXXXXX..XX........XXX.........X..X........X................X..X...............XXX.XXX....X..X.XX......X.X.........
	//............X...X.X.X......XXX.XX....X..................XX....XX....X..X...X...........X.......X.X.................X..X.........XX...XXX......XXXX.X...XX....XX.........X...XX.............XX........X...X.X...............XXXX..X....X..X.XX.....X......XXX...
	//......X.XXXX...XXX.X................X........XXX......XX.X..X.X.....XXXX......X.X..............X.XX................X..X.....X...XX.X.X..........XX.XXXX......X..............XX..X..........XX...XX..XXX...........XXX..XX.XXX..XXX........XX.....XX.XX..X.XXXX.
	//.......X.X............................XX....XXXXX...............X..XX.X......X..X............X.XX...................X......X.X.....................XXX..................X.X....X.X.............X.......XX...........X..XX......XX...............X...XX.XX.X.X.X
	//.....XX...X...X.XX....................XXX.........X...XXX........XXX...........XX............XX......................X..X..X............................................XX.....X.XX.XX.................X.X.........X...XX.X......X.........XX....XXX....XX...X.
	//................XXXXX.................XXX...X...XX.X.........XX...X.................................................XX.X..XX....................................................X...X.XX.....................XXX.................XX.......XXX....XX......X.....
	//......XX....XXX....XX.................X.....X...XX.X.X...X.XXX..X......................X.............................XXXX......XX.XX...............................X......XXX........XX.X.........X.X...X.....X.X.........X......XX.......X....................
	//............XX.X...........X.........XX.....X...XX.........X....X..X..................X.X........................XX..XXX..........XX...X.....................X....X.X......XX.........XXX..........X...XX.....X.X......XXX.................XXX..XX...........XX
	//.......X.X....XX..........X.........X.......X.....X.......XXX.X......................XX.XX..........XX............X...........XXX......XX........X.......XX..X.....XX.....X.........XXX..X......XXX...X..X............X.....................XX.XX........XXX..X
	//..........X................X.X.X.X...X.X.....X......X.......X.XX......................XXX...........XX.................X....XXX.......X.X.........X.....XXX..X.X......................XX........X.X.XX.X.X............X.X...................XX.XX.......XX...X.
	//........XX.............XX.XXXX.X..X...X.......XXXXXX...XX.....XX.......................XX...........XX..XXX....X.............XXX.......X.........XXX...X.............................XXX........XX..XXX.X.............................XX...........X...X.X...X.
	//.....................XXXX.X.XXXX..X.............XX.....................................X.................XX.....X............X..X......XX.........X...X.XX.XXX..................................X................................XX..X..X.........XXXXXX...X...
	//.....................X..........XXX...................................................X......X.X......X..XX...XX..............X.X......XXX.X.....X....X..X..XX.........X.X.....................X..X..............................XX...XX.........X.............
	//......................XXXXX...................................................................XX.......XX.....X................X............XX.........XX...............X......................XXXX...............................................XXXX.........
}

func ExampleSetRand() {
	b := MakeBoard(16, 16)
	SetRand(b, 0, 0.5)

	fmt.Print(Fmt(b))
	// Output:
	//.X.XXXX..XX..X.X
	//.X..XX.XX.XX.XXX
	//X.XX.X.X.X...X..
	//X.X.X.X...X...XX
	//..XXX.XX.XXX.X..
	//..X...X.X.XXXX..
	//XXXXX.....X.X...
	//XX.XX.X.X..X.XXX
	//.X..XXXX...X...X
	//X.X.XX...X.X.X..
	//.XX.X.XXXXXXX...
	//X..X.XXX...XXXX.
	//.X......X.X.XX..
	//.XX..X..X.....XX
	//.XXX.X...XX..X..
	//....X.XXX.XX....
	//
}

func TestNeighbors(t *testing.T) {
	b := MakeBoard(3, 4)
	b.Set(0, 0, true)
	b.Set(0, 1, true)
	b.Set(0, 2, true)

	test := []struct {
		r, c int
		want int
	}{
		{0, 0, 1},
		{0, 1, 2},
		{0, 2, 1},
		{1, 1, 3},
	}

	for _, c := range test {
		if have := b.Neighbors(c.r, c.c); have != c.want {
			t.Errorf("%#v: got: %v", c, have)
		}
	}

}

func TestBoardAccess(t *testing.T) {
	b := MakeBoard(3, 4)
	b.Set(0, 0, true)
	b.Set(2, 3, true)
	b.Set(1, 1, true)

	test := []struct {
		r, c int
		want bool
	}{
		{0, 0, true},
		{0, 1, false},
		{0, 2, false},
		{0, 3, false},
		{1, 0, false},
		{1, 1, true},
		{1, 2, false},
		{1, 3, false},
		{2, 0, false},
		{2, 1, false},
		{2, 2, false},
		{2, 3, true},

		{0, 4, false},
		{-1, 0, false},
		{0, -1, false},
		{3, 0, false},
	}

	for _, c := range test {
		if have := b.Get(c.r, c.c); have != c.want {
			t.Errorf("%#v: got: %v", c, have)
		}
	}
}

func TestMakeBoard(t *testing.T) {
	b := MakeBoard(5, 3)
	if b.Rows() != 5 || b.Cols() != 3 {
		t.Fail()
	}
}
